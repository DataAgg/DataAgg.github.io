<!DOCTYPE html><html lang="en" dir="ltr" class="2xl:text-[20px]"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="sitemap" href="/sitemap-index.xml"><link rel="shortcut icon" href="/_astro/favicon.sNBBSGPZ.ico"><link rel="icon" type="image/svg+xml" href="/_astro/favicon.jAUM_1GV.svg"><link rel="mask-icon" href="/_astro/favicon.jAUM_1GV.svg" color="#8D46E7"><link rel="apple-touch-icon" sizes="180x180" href="/_astro/apple-touch-icon.qzCMJsat.png"><style is:global>
  :root {
    --aw-font-sans: 'Inter Variable';
    --aw-font-serif: var(--aw-font-sans);
    --aw-font-heading: var(--aw-font-sans);
    --aw-color-primary: #6966ff;
    --aw-color-secondary: #3ed9a4;
    --aw-color-accent: #e45555;
    --aw-color-text-heading: rgb(0 0 0);
    --aw-color-text-default: #181818;
    --aw-color-text-muted: rgb(0x18 0x18 0x18 / 66%);
    --aw-color-bg-page: #ffffff;
    --aw-color-bg-page-dark: #ffffff;
    --aw-color-layer1: #ffffff;
    --aw-color-layer2: #e9ecee;
    --aw-color-layer3: #ffffff;
    --aw-color-layer4: #f7f8fa;
    --aw-color-layer5: #ffffff;
    --aw-color-layer6: #edf0f2;
    --aw-color-layer7: #d5dadf;
    --aw-color-layer8: #ffffff;

    ::selection {
      background-color: lavender;
    }
  }

  .dark {
    --aw-font-sans: 'Inter Variable';
    --aw-font-serif: var(--aw-font-sans);
    --aw-font-heading: var(--aw-font-sans);
    --aw-color-primary: #6966ff;
    --aw-color-secondary: #3ed9a4;
    --aw-color-accent: #e45555;
    --aw-color-text-heading: rgb(0 0 0);
    --aw-color-text-default: #fafafa;
    --aw-color-text-muted: rgb(0xfa 0xfa 0xfa / 66%);
    --aw-color-bg-page: #000000;
    --aw-color-bg-page-dark: #000000;
    --aw-color-layer1: #000000;
    --aw-color-layer2: #18181b;
    --aw-color-layer3: #0c0c0d;
    --aw-color-layer4: #212124;
    --aw-color-layer5: #303033;
    --aw-color-layer6: #3b3b3f;
    --aw-color-layer7: #494950;
    --aw-color-layer8: #56565c;

    ::selection {
      background-color: #181825;
      color: snow;
    }
  }
</style><script>(function(){const defaultTheme = "dark";

  function applyTheme(theme) {
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
    const matches = document.querySelectorAll('[data-aw-toggle-color-scheme] > input');

    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.checked = theme !== 'dark';
      });
    }
  }

  if ((defaultTheme && defaultTheme.endsWith(':only')) || (!localStorage.theme && defaultTheme !== 'system')) {
    applyTheme(defaultTheme.replace(':only', ''));
  } else if (
    localStorage.theme === 'dark' ||
    (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
  ) {
    applyTheme('dark');
  } else {
    applyTheme('light');
  }
})();</script><title>比特币块链和挖矿原理(修订版) — TokenAgg DAO</title>
<meta name="description" content="Network protocol specification - Stratum platform(draft)" />
<meta name="robots" content="index,follow" />
<link rel="canonical" href="https://dataagg.github.io/btcminning" />
<meta property="og:title" content="比特币块链和挖矿原理(修订版)" />
<meta property="og:description" content="Network protocol specification - Stratum platform(draft)" />
<meta property="og:url" content="https://dataagg.github.io/btcminning" />
<meta property="og:type" content="article" />
<meta property="og:image" content="https://dataagg.github.io/imgs/tools.jpg" />

<meta property="og:locale" content="en" />
<meta property="og:site_name" content="TokenAgg DAO" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@watano" />
<meta name="twitter:creator" content="@watano" /><!-- Uncomment line below to activate View Transitions --><!-- <ViewTransitions fallback="swap" /> --><link rel="stylesheet" href="/_astro/click-through.45fq7QCF.css" /></head> <body class="antialiased text-default bg-page tracking-tight">   <header class="sticky top-0 z-40 flex-none mx-auto w-full border-b border-gray-50/0 transition-[opacity] ease-in-out" data-aw-sticky-header id="header"> <div class="absolute inset-0"></div> <div class="relative text-default py-3 px-3 md:px-6 mx-auto w-full md:flex md:justify-between max-w-7xl"> <div class="flex justify-between"> <a class="flex items-center" href="/"> <img src="/_astro/logo-long-dark.TphFalWY_Z1Yevjd.svg" id="toplogo" alt="TokenAgg DAO" width="199" height="64" loading="lazy" decoding="async"><script>(function(){const defaultTheme = "dark";

  if (document.documentElement.classList.contains('dark')) {
    document.getElementById('toplogo').src = '/imgs/logo-long-dark.svg';
  } else {
    document.getElementById('toplogo').src = '/imgs/logo-long-light.svg';
  }
})();</script> </a> <div class="flex items-center md:hidden"> <button class="flex flex-col h-12 w-12 rounded justify-center items-center cursor-pointer group" aria-label="Toggle Menu" data-aw-toggle-menu> <span class="sr-only">Toggle Menu</span>  <span aria-hidden="true" class="h-0.5 w-6 my-1 rounded-full bg-black dark:bg-white transition ease transform duration-200 opacity-80 group-[.expanded]:rotate-45 group-[.expanded]:translate-y-2.5"></span> <span aria-hidden="true" class="h-0.5 w-6 my-1 rounded-full bg-black dark:bg-white transition ease transform duration-200 opacity-80 group-[.expanded]:opacity-0"></span> <span aria-hidden="true" class="h-0.5 w-6 my-1 rounded-full bg-black dark:bg-white transition ease transform duration-200 opacity-80 group-[.expanded]:-rotate-45 group-[.expanded]:-translate-y-2.5"></span>  </button> </div> </div> <nav class="items-center w-full md:w-auto hidden md:flex text-default overflow-y-auto overflow-x-hidden md:overflow-y-visible md:overflow-x-auto md:mx-5" aria-label="Main navigation"> <ul class="flex flex-col md:flex-row md:self-center w-full md:w-auto text-xl md:text-[0.9375rem] tracking-[0.01rem] font-medium"> <li class="dropdown">  <button class="hover:text-link dark:hover:text-white px-4 py-3 flex items-center"> 项目  <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-3.5 h-3.5 ml-0.5 rtl:ml-0 rtl:mr-0.5 hidden md:inline" data-icon="tabler:chevron-down">  <symbol id="ai:tabler:chevron-down"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9l6 6l6-6"/></symbol> <use  xlink:href="#ai:tabler:chevron-down"></use> </svg> </button> <ul class="dropdown-menu md:backdrop-blur-md dark:md:bg-dark rounded md:absolute pl-4 md:pl-0 md:hidden font-medium md:bg-white/90 md:min-w-[200px] drop-shadow-xl"> <li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/project/index.html?id=001"> TokenAgg DAO </a> </li><li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/project/index.html?id=012"> DApp Admin </a> </li> </ul>  </li><li class="dropdown">  <button class="hover:text-link dark:hover:text-white px-4 py-3 flex items-center"> 解决方案  <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-3.5 h-3.5 ml-0.5 rtl:ml-0 rtl:mr-0.5 hidden md:inline" data-icon="tabler:chevron-down">   <use  xlink:href="#ai:tabler:chevron-down"></use> </svg> </button> <ul class="dropdown-menu md:backdrop-blur-md dark:md:bg-dark rounded md:absolute pl-4 md:pl-0 md:hidden font-medium md:bg-white/90 md:min-w-[200px] drop-shadow-xl"> <li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/solution1"> 生鲜配送 </a> </li><li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/solution2"> 诊所联盟 </a> </li><li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/solution3"> 妙蛙云池 </a> </li> </ul>  </li><li class="dropdown">  <button class="hover:text-link dark:hover:text-white px-4 py-3 flex items-center"> 公司  <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-3.5 h-3.5 ml-0.5 rtl:ml-0 rtl:mr-0.5 hidden md:inline" data-icon="tabler:chevron-down">   <use  xlink:href="#ai:tabler:chevron-down"></use> </svg> </button> <ul class="dropdown-menu md:backdrop-blur-md dark:md:bg-dark rounded md:absolute pl-4 md:pl-0 md:hidden font-medium md:bg-white/90 md:min-w-[200px] drop-shadow-xl"> <li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/teams"> 关于我们 </a> </li><li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/intro"> 公司价值 </a> </li><li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/story"> 成功案例 </a> </li><li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/privacy"> 隐私条款 </a> </li> </ul>  </li><li class="dropdown">  <button class="hover:text-link dark:hover:text-white px-4 py-3 flex items-center"> 博客  <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-3.5 h-3.5 ml-0.5 rtl:ml-0 rtl:mr-0.5 hidden md:inline" data-icon="tabler:chevron-down">   <use  xlink:href="#ai:tabler:chevron-down"></use> </svg> </button> <ul class="dropdown-menu md:backdrop-blur-md dark:md:bg-dark rounded md:absolute pl-4 md:pl-0 md:hidden font-medium md:bg-white/90 md:min-w-[200px] drop-shadow-xl"> <li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/category/项目推荐"> 项目推荐 </a> </li><li> <a class="first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap" href="/category/基础知识"> 基础知识 </a> </li> </ul>  </li> </ul> </nav> <div class="hidden md:self-center flex md:flex items-center md:mb-0 fixed w-full md:w-auto md:static justify-end left-0 rtl:left-auto rtl:right-0 bottom-0 p-3 md:p-0"> <div class="items-center flex justify-between w-full md:w-auto"> <div class="flex"> <button type="button" class="text-muted dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Toggle between Dark and Light mode" data-aw-toggle-color-scheme><svg width="1em" height="1em" viewBox="0 0 24 24" class="w-6 h-6 md:w-5 md:h-5 md:inline-block" data-icon="tabler:sun">  <symbol id="ai:tabler:sun"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12a4 4 0 1 0 8 0a4 4 0 1 0-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7l-.7.7m0 11.4l.7.7m-12.1-.7l-.7.7"/></symbol> <use  xlink:href="#ai:tabler:sun"></use> </svg></button> <a class="text-muted dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="RSS Feed" href="/rss.xml"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-5 h-5" data-icon="tabler:rss">  <symbol id="ai:tabler:rss"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 19a1 1 0 1 0 2 0a1 1 0 1 0-2 0M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9"/></symbol> <use  xlink:href="#ai:tabler:rss"></use> </svg> </a> </div> <span class="ml-4 rtl:ml-0 rtl:mr-4"> <a class="btn-secondary ml-2 py-2.5 px-5.5 md:px-6 font-semibold shadow-none text-sm w-auto" target="_blank" rel="noopener noreferrer" href="https://github.com/dataagg">Github</a> </span> </div> </div> </div> </header>  <main>  <section class="py-8 sm:py-16 lg:py-20 mx-auto"> <article> <header class=""> <div class="flex justify-between flex-col sm:flex-row max-w-3xl mx-auto mt-0 mb-2 px-4 sm:px-6 sm:items-center"> <p> <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-4 h-4 inline-block -mt-0.5 dark:text-gray-400" data-icon="tabler:clock">  <symbol id="ai:tabler:clock"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0"/><path d="M12 7v5l3 3"/></g></symbol> <use  xlink:href="#ai:tabler:clock"></use> </svg> <time datetime="Wed Aug 23 2017 08:00:00 GMT+0800 (香港标准时间)" class="inline-block">Aug 23, 2017</time>  
· <a class="capitalize hover:underline inline-block" href="/category/基础知识"> 基础知识 </a>   · 32 min read </p> </div> <h1 class="px-4 sm:px-6 max-w-3xl mx-auto text-4xl md:text-5xl font-bold leading-tighter tracking-tighter font-heading"> 比特币块链和挖矿原理(修订版) </h1> <p class="max-w-3xl mx-auto mt-4 mb-8 px-4 sm:px-6 text-xl md:text-2xl text-muted dark:text-slate-400 text-justify"> Network protocol specification - Stratum platform(draft) </p> <img src="/imgs/tools.jpg" width="900" height="506" sizes="(max-width: 900px) 400px, 900px" style="object-fit: cover; object-position: center; max-width: 900px; max-height: 506px; aspect-ratio: 1.7786561264822134; width: 100%;" class="max-w-full lg:max-w-[900px] mx-auto mb-6 sm:rounded-md bg-gray-400 dark:bg-slate-700" alt="Network protocol specification - Stratum platform(draft)" loading="eager" decoding="async"> </header> <div class="mx-auto px-6 sm:px-6 max-w-3xl prose prose-lg lg:prose-xl dark:prose-invert dark:prose-headings:text-slate-300 prose-md prose-headings:font-heading prose-headings:leading-tighter prose-headings:tracking-tighter prose-headings:font-bold prose-a:text-primary dark:prose-a:text-blue-400 prose-img:rounded-md prose-img:shadow-lg mt-8 prose-headings:scroll-mt-[80px]"> <h1 id="比特币块链和挖矿原理-修订版">比特币块链和挖矿原理 (修订版)</h1>
<p><a href="http://www.8btc.com/bitcoin_block_chain">原文</a>排版实在是惨不忍睹，所以手工校正了一下，方便大家阅读，如果侵权请及时联系我，我立即撤稿。</p>
<hr>
<p>译者：申屠青春深圳大学 ATR 国防科技重点实验室博士新浪微博　@我看比特币</p>
<p>注意：本文可随意转发，请留下译者信息，如果觉得本文对你有用，请给译者捐赠，以便翻译更多比特币的核心资料。捐赠地址：<code>1faVxBp2KmST98p3tJjx2MQP98JLLnF2Q</code></p>
<h2 id="译者前言">译者前言</h2>
<p>​ 比特币在国内已经众所周知，但是技术研究并未有效开展，大部分人处于知道和了解程度，目前比特圈中许多人对比特币能做什么，同样了解不多。一个重要原因是大多数比特币核心资料都是英文，很少有人能静心看完如此繁杂的英文资料。本人博士论文的研究方向是比特币，在研究其英文技术的同时，拟对一些重要资料进行翻译，让更多的圈内人对比特币有更多的理解。</p>
<p>​ 本文主题是比特币区块、创世块、挖矿原理、难度等的技术资料，综合了比特币官方威客上的众多资料翻译和编写而成。</p>
<h2 id="正文">正文</h2>
<h2 id="1区块-block">1。区块 (Block)</h2>
<p>​ 比特币网络中，数据以文件的形式被永久记录，我们称之为区块。一个区块是一些或所有最新比特币交易的记录集，且未被其他先前的区块记录。区块可以想像为一个城市记录者的记录本上的单独一页纸 (对房地产产权的变更记录) 或者是股票交易所的总帐本。在绝大多数情况下，新区块被加入到记录最后 (在比特币中的名称为：<a href="https://en.bitcoin.it/wiki/Block_chain">块链</a>，一旦写上，就再也不能改变或删除。每个区块记录了它被创建之前发生的所有事件。</p>
<h3 id="11-区块结构-block-structure">1.1 区块结构 (Block Structure)</h3>
<div style="overflow:auto">


































<table><thead><tr><th><strong>数据项</strong></th><th><strong>描述</strong></th><th><strong>长度</strong></th></tr></thead><tbody><tr><td>Magic no 魔术数</td><td>总是 0xD9B4BEF9</td><td>4 字节</td></tr><tr><td>Blocksize 块大小</td><td>到区块结束的字节长度</td><td>4 字节</td></tr><tr><td>Blockheader 块头</td><td><a href="https://en.bitcoin.it/wiki/Block_hashing_algorithm">包含 6 个数据项</a></td><td>80 字节</td></tr><tr><td>Transaction counter 交易数量</td><td>正整数 <a href="https://en.bitcoin.it/wiki/Protocol_specification#Variable_length_integer">VI = VarInt</a></td><td>1 – 9 字节</td></tr><tr><td><a href="https://en.bitcoin.it/wiki/Transactions">transactions</a> 交易</td><td>交易列表(非空)</td><td>&#x3C;Transaction counter>-许多交易</td></tr></tbody></table></div>
<h3 id="12-详细说明-explanation">1.2 详细说明 (Explanation)</h3>
<p>​ 每个区块包括一些或所有近期交易、前一个区块的引用、以及其他数据。它还包括一个挖矿难度的答案-该答案对每个区块是唯一的。新区块如果没有正确答案，不能被发送到网络中-“<a href="https://en.bitcoin.it/wiki/Mining">挖矿</a>” 的过程本质上是在竞争中 “解决” 当前区块。每个区块中的数学问题难以解决，但是一旦发现了一个有效解，其他网络节点很容易验证这个解的正确性，对于给定的区块可能有多个有效解-但对于要解决的区块来说只需一个解。</p>
<p>​ 因为每解决一个区块，都会得到新产生的比特币奖励，每个区块包含一个记录，记录中的<a href="https://en.bitcoin.it/wiki/Bitcoin_address">比特币地址</a>是有权获得比特币奖励的地址。这个纪录被称为生产交易、或者 <a href="https://en.bitcoin.it/wiki/Coinbase">coinbase</a> 交易，它经常是每个区块的第一个交易。每个块区生产的比特币数量是 50 个，每产生 21 万个区块后减少一半 (时间大约是 4 年)。</p>
<p>​ 发送者在网络中广播比特币交易，所有试图解决区块的矿工节点，收集了这些交易记录，把它们加到矿工节点正在解决的区块中。</p>
<p>​ 挖矿难度由比特币网络自动调整，使之实现平均每小时解决 6 个区块的目标。每 2016 个区块 (大约两周) 后，所有客户端把新区块的实际数目与目标数量相比较，并且按照差异的百分比调整目标 HASH 值，来增加 (或降低) 产生区块的难度。</p>
<p>​ 因为所有区块包含前一个区块的引用，现存的所有区块的集合可以说是形成了一条链，然而，块链有可能产生暂时分叉-举个例子，如果两个矿工同时为一个区块产生不同的有效解，两者相互不知。P2P 网络会在一段短时间内消除这些分叉，该链仅有一个分支存活。</p>
<p>​ 客户端接受 “最长” 块链作为有效链，整条块链的 “<a href="https://en.bitcoin.it/wiki/Block_chain">长度</a>” 是指具有最大难度的链，而不是指具有最多区块数量的块链，可防止某些人创建大量低难度区块，故意使块链分叉，并且让网络接受它成为 “最长” 的块链。</p>
<p>(译者按：以下非标准区块内容来自 <a href="https://en.bitcoin.it/wiki/Nonstandard_block">Nonstandard_block</a>，略有改动)</p>
<p>​ 非标准区块：是指包括非标准交易的区块，交易的标准与否，要参考比特币客户端源代码中的 <code>IsStandard()</code> 函数。客户端不会传播非标准交易，但是某些矿池的矿工会把合法的非标准交易加入到区块中，形成非标准区块，客户端在计算难度最长的块链时，会考虑非标准区块。</p>
<h4 id="区块的一般问题">区块的一般问题</h4>
<ul>
<li>
<p>(1) 目前有多少个区块？</p>
<p><a href="http://blockexplorer.com/q/getblockcount">目前的区块数</a>，访问：<a href="http://blockexplorer.com/q/getblockcount">getblockcount</a></p>
</li>
<li>
<p>(2) 区块的最大数量是多少？</p>
<p>没有最大数量，区块以平均每 10 分钟一个的速度，源源不断地加到块链结尾。</p>
</li>
<li>
<p>(3) 甚至当所有的 2100 万个比特币全部被挖完，还是没有最大数量吗？</p>
<p>对的，区块用来确认交易在某一特定时间存在，即使比特币全部被挖完，交易还是会发生，所以只要人们还在交易比特币，区块还会被创建。</p>
</li>
<li>
<p>(4) 我要花多少时间生成一个区块？</p>
<p>没有人能够准确回答，这里有个<a href="https://en.bitcoin.it/wiki/Generation_Calculator">生产计算器</a>，可以告诉你可能要花多少时间。</p>
</li>
<li>
<p>(5) 如果我完成计算一个区块的 1%进度…</p>
<p>没有解决一个区块的 1%的说法，你不会在解决区块上有任何进展，在工作 24 小时后，你解决一个区块的机率和 24 小时前一样，若非信仰比特币就是众所周知的赌徒谬误。</p>
<p>这就像同时抛 53 枚硬币，使得它们人头向上，每次你试验，你的成功机率都是一样的。</p>
</li>
<li>
<p>(6) 我还能找到更多的技术细节吗？</p>
<p>在下面的<a href="https://en.bitcoin.it/wiki/Block_hashing_algorithm">区块 HASH 算法</a>中，有更多的技术细节。</p>
</li>
</ul>
<h2 id="2创世块-genesis-block">2。创世块 (Genesis Block)</h2>
<p>​ 创世块是指块链的第一个块，现在的比特币客户端版本把块号定为 0，以前的版本把该块块号定为 1。</p>
<p>​ 以下是创世块的一种表示，它出现在以前的比特币代码的注释中 (<a href="http://sourceforge.net/p/bitcoin/code/133/tree/trunk/main.cpp#l1613">第 1613 行</a>)，第一个代码段定义了创建该块所需的所有变量，第二个代码段是标准的区块类格式，还包含了第一个代码段中缩短版本的数据。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">GetHash</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f</span></span>
<span class="line"><span style="color:#E1E4E8">hashMerkleRoot </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b</span></span>
<span class="line"><span style="color:#E1E4E8">txNew.vin[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">].scriptSig     </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 486604799</span><span style="color:#79B8FF"> 4</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">736B6E616220726F662074756F6C69616220646E6F63657320666F206B6E697262206E6F20726F6C6C65636E61684320393030322F6E614A2F33302073656D695420656854</span></span>
<span class="line"><span style="color:#E1E4E8">txNew.vout[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">].nValue       </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 5000000000</span></span>
<span class="line"><span style="color:#E1E4E8">txNew.vout[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">].scriptPubKey </span><span style="color:#F97583">=</span></span>
<span class="line"><span style="color:#F97583">0x</span><span style="color:#79B8FF">5F1DF16B2B704C8A578D0BBAF74D385CDE12C11EE50455F3C438EF4C3FBCF649B6DE611FEAE06279A60939E028A8D65C10B73071A6F16719274855FEB0FD8A6704</span><span style="color:#E1E4E8"> OP_CHECKSIG</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">block.nVersion </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">block.nTime    </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1231006505</span></span>
<span class="line"><span style="color:#E1E4E8">block.nBits    </span><span style="color:#F97583">=</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">1d00ffff</span></span>
<span class="line"><span style="color:#E1E4E8">block.nNonce   </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2083236893</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">CBlock</span><span style="color:#E1E4E8">(hash</span><span style="color:#F97583">=</span><span style="color:#79B8FF">000000000019</span><span style="color:#F97583">d6</span><span style="color:#E1E4E8">, ver</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, hashPrevBlock</span><span style="color:#F97583">=0</span><span style="color:#79B8FF">0000000000000</span><span style="color:#E1E4E8">, hashMerkleRoot</span><span style="color:#F97583">=</span><span style="color:#79B8FF">4</span><span style="color:#F97583">a5e1e</span><span style="color:#E1E4E8">, nTime</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1231006505</span><span style="color:#E1E4E8">, nBits</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#F97583">d00ffff</span><span style="color:#E1E4E8">, nNonce</span><span style="color:#F97583">=</span><span style="color:#79B8FF">2083236893</span><span style="color:#E1E4E8">, vtx</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">CTransaction</span><span style="color:#E1E4E8">(hash</span><span style="color:#F97583">=</span><span style="color:#79B8FF">4</span><span style="color:#F97583">a5e1e</span><span style="color:#E1E4E8">, ver</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, vin.size</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, vout.size</span><span style="color:#F97583">=</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, nLockTime</span><span style="color:#F97583">=</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">CTxIn</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">COutPoint</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0</span><span style="color:#79B8FF">00000</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">), coinbase </span><span style="color:#F97583">0</span><span style="color:#79B8FF">4</span><span style="color:#F97583">ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">CTxOut</span><span style="color:#E1E4E8">(nValue</span><span style="color:#F97583">=</span><span style="color:#79B8FF">50.00000000</span><span style="color:#E1E4E8">, scriptPubKey</span><span style="color:#F97583">=0x</span><span style="color:#79B8FF">5F1DF16B2B704C8A578D0B</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">vMerkleTree: </span><span style="color:#79B8FF">4</span><span style="color:#F97583">a5e1e</span></span></code></pre>
<p>coinbase 参数 (看上面的十六进制) 包含了以下一段话：</p>
<p><code>The Times 03/Jan/2009 Chancellor on brink of second bailout for banks</code></p>
<p><a href="http://7fvhfe.com1.z0.glb.clouddn.com/wp-content/uploads/2014/03/221.jpg"><img src="http://7fvhfe.com1.z0.glb.clouddn.com/wp-content/uploads/2014/03/221.jpg" alt="22"></a></p>
<p>​ “2009 年 1 月 3 日，首相第二次对处于崩溃边缘的银行进行紧急救助”，这句话正是<a href="http://zh.wikipedia.org/wiki/%E6%B3%B0%E6%99%A4%E5%A3%AB%E6%8A%A5">泰晤士报</a>当天的头版文章标题。这应该是一个该区块在 2009 年 1 月 3 日或之后创建的一个证据，同时也是对银行系统采用部分准备金制度导致不稳定性的一个说明。</p>
<p>​ 创世块的收益不可能被花掉，因为创世块是用代码表示的 (这个巧合可能是故意的)，尽管如此，其 50BTC 收益还是被发送到地址：<a href="http://blockexplorer.com/address/1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa">1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa</a>。</p>
<p>​ (译者按：创世块的收益花不掉，原因如下：比特币客户端把区块和交易分开存贮在两个数据库中，当客户端发现区块数据库为空时，用代码直接生成一个创世块，但是没有生成这个交易，所以客户端中的交易数据库中是没有发送到上述地址这个交易的，因而一旦收到要花掉该收益的交易时，都会拒绝，所以无法得到任何确认，就花不掉这 50 个币。出现这种情况很可能是中本聪故意的。)</p>
<p>原始区块数据</p>
<p>​ 创世块的原始十六进制如下所示：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>00000000   01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00   …………….</span></span>
<span class="line"><span>00000010   00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00   …………….</span></span>
<span class="line"><span>00000020   00 00 00 00 3B A3 ED FD  7A 7B 12 B2 7A C7 2C 3E   ….;£íýz{.²zÇ,></span></span>
<span class="line"><span>00000030   67 76 8F 61 7F C8 1B C3  88 8A 51 32 3A9F B8 AA   gv.a.È.ÃˆŠQ2:Ÿ¸ª</span></span>
<span class="line"><span>00000040   4B 1E 5E 4A 29 AB 5F 49  FF FF 00 1D 1D AC 2B 7C   K.^J)«_Iÿÿ…¬+|</span></span>
<span class="line"><span>00000050   01 01 00 00 00 01 00 00  00 00 00 00 00 00 00 00   …………….</span></span>
<span class="line"><span>00000060   00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00   …………….</span></span>
<span class="line"><span>00000070   00 00 00 00 00 00 FF FF  FF FF 4D 04 FF FF 00 1D   ……ÿÿÿÿM.ÿÿ..</span></span>
<span class="line"><span>00000080   01 04 45 54 68 65 20 54  69 6D 65 73 20 30 33 2F   ..EThe Times 03/</span></span>
<span class="line"><span>00000090   4A 61 6E 2F 32 30 30 39  20 43 68 61 6E 63 65 6C   Jan/2009 Chancel</span></span>
<span class="line"><span>000000A0   6C6F 72 20 6F 6E 20 62  72 69 6E 6B 20 6F 66 20   lor on brink of</span></span>
<span class="line"><span>000000B0   73 65 63 6F 6E 64 20 62  61 69 6C6F 75 74 20 66   second bailout f</span></span>
<span class="line"><span>000000C0   6F 72 20 62 61 6E 6B 73  FF FF FF FF 01 00 F2 05   or banksÿÿÿÿ..ò.</span></span>
<span class="line"><span>000000D0   2A 01 00 00 00 43 41 04  67 8A FD B0 FE 55 48 27   *….CA.gŠý°þUH’</span></span>
<span class="line"><span>000000E0   19 67 F1 A6 71 30 B7 10  5C D6 A8 28 E0 39 09 A6   .gñ¦q0·.\Ö¨(à9.¦</span></span>
<span class="line"><span>000000F0   79 62 E0 EA 1F 61 DE B6  49 F6 BC 3F4C EF 38 C4   ybàê.aÞ¶Iö¼?Lï8Ä</span></span>
<span class="line"><span>00000100   F3 55 04 E5 1E C1 12 DE  5C 38 4D F7 BA 0B 8D 57   óU.å.Á.Þ\8M÷º..W</span></span>
<span class="line"><span>00000110   8A4C 70 2B 6B F1 1D 5F  AC 00 00 00 00            ŠLp+kñ._¬….</span></span></code></pre>
<p>分开来看，如下所示：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>01000000 – 版本号</span></span>
<span class="line"><span>0000000000000000000000000000000000000000000000000000000000000000 – prev block</span></span>
<span class="line"><span>3BA3EDFD7A7B12B27AC72C3E67768F617FC81BC3888A51323A9FB8AA4B1E5E4A – merkle root</span></span>
<span class="line"><span>29AB5F49 – 时间戳</span></span>
<span class="line"><span>FFFF001D – 目标HASH值</span></span>
<span class="line"><span>1DAC2B7C – 随机数</span></span>
<span class="line"><span>01 – 交易个数</span></span>
<span class="line"><span>01000000 – 版本</span></span>
<span class="line"><span>01 – 输入</span></span>
<span class="line"><span>0000000000000000000000000000000000000000000000000000000000000000FFFFFFFF – 前一个输出</span></span>
<span class="line"><span>4D – 脚本长度</span></span>
<span class="line"><span>04FFFF001D0104455468652054696D65732030332F4A616E2F32303039204368616E63656C6C6F72206F6E206272696E6B206F66207365636F6E64206261696C6F757420666F722062616E6B73 – scriptsig脚本</span></span>
<span class="line"><span>FFFFFFFF – 序列号</span></span>
<span class="line"><span>01 – 输出</span></span>
<span class="line"><span>00F2052A01000000 – 50 BTC的收益</span></span>
<span class="line"><span>43 – 脚本scriptPubKey的长度</span></span>
<span class="line"><span>4104678AFDB0FE5548271967F1A67130B7105CD6A828E03909A67962E0EA1F61DEB649F6BC3F4CEF38C4F35504E51EC112DE5C384DF7BA0B8D578A4C702B6BF11D5FAC – 脚本scriptPubKey</span></span>
<span class="line"><span>00000000 –锁定时间</span></span></code></pre>
<p>JSON 版本的创世块如下所示 (译者按：JSON 表示方式是译者加的，方便读者对照研究)：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">  "hash"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "ver"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "prev_block"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"0000000000000000000000000000000000000000000000000000000000000000"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "mrkl_root"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "time"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1231006505</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "bits"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">486604799</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "nonce"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">2083236893</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "n_tx"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "size"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">285</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "tx"</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#79B8FF">      "hash"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      "ver"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      "vin_sz"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      "vout_sz"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      "lock_time"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      "size"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">204</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">      "in"</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#79B8FF">          "prev_out"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">            "hash"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"0000000000000000000000000000000000000000000000000000000000000000"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">            "n"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">4294967295</span></span>
<span class="line"><span style="color:#E1E4E8">          },</span></span>
<span class="line"><span style="color:#79B8FF">          "coinbase"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b73"</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">      ],</span></span>
<span class="line"><span style="color:#79B8FF">      "out"</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#79B8FF">          "value"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"50.00000000"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">          "scriptPubKey"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"04678afdb0fe5548271967f1a67130b7105cd6a828e03909a67962e0ea1f61deb649f6bc3f4cef38c4f35504e51ec112de5c384df7ba0b8d578a4c702b6bf11d5f OP_CHECKSIG"</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">      ]</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  ],</span></span>
<span class="line"><span style="color:#79B8FF">  "mrkl_tree"</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">"4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="3块链-block-chain">3。块链 (Block Chain)</h2>
<p>​ 块链是所有<a href="https://en.bitcoin.it/wiki/Node">比特币节点</a>共享的交易数据库，这些节点基于比特币协议参与到比特币网络中来。块链包含每一个曾在比特币系统执行过的<a href="https://en.bitcoin.it/wiki/Transaction">交易</a>。根据这个信息，人们可以找到任何时候任一个<a href="https://en.bitcoin.it/wiki/Address">地址</a>中的币数量，</p>
<p>​ 每个区块包含前一个区块的 <a href="https://en.bitcoin.it/wiki/Hash">HASH</a> 值，这就使得从<a href="https://en.bitcoin.it/wiki/Genesis_block">创世块</a>到当前块形成了一条块链，每个区块必定按时间顺序跟随在前一个区块之后，因为如果不知道前一块区块的 HASH 值就没法生成当前区块。要改变一个已经在块链中存在一段时间的区块，从计算上来说是不可行的，因为如果它被改变，它之后的每个区块必须随之改变。这些特性使得<a href="https://en.bitcoin.it/wiki/Double-spending">双花</a>比特币非常困难，块链是比特币的最大创新。</p>
<p>​ 如果一个区块是最长块链的最后一个区块，诚实的矿工只会在这个区块基础生成后续块 (创建新块时通过引用该块来实现)。“长度” 是被计算成块链的所有联合难度，而不是区块数目，尽管这个区别仅仅在防御几个潜在攻击时有用。如果一个块链中的所有区块和交易有效，则该块链有效，并且要以创世块开头。</p>
<p>​ 对于块链中的任何区块来说，只有一条通向创世块的路径。然而，从创世块出发，却可能有分叉。当两个区块产生的时间仅相差几秒时，可能会产生包含一个区块的分叉。当以上现象出现时，矿工节点会根据收到区块的时间，在先收到的区块基础上继续挖矿。哪个区块的后续区块先出现，这个区块就被包括进主链，因为这条块链更长。在修正需要向后兼容的程序 BUG 后，出现过更严重的分叉。</p>
<p>​ 短块链 (或有效块链) 中的区块没有作用，当比特币客户端转向另一个长块链时，短块链中所有有效的交易将被重新加入到交易队列池中，将被包括中另一个块中。短块链中的区块收益不会在长链中出现，因而这些收益实际上是丢失了，这就是比特币网络强化的 100 个区块成熟时间的存在原因。</p>
<p>​ 在短块链中的区块经常被称为 “孤立” 区块，这是因为在长块链中的生产交易没有父区块，因而这些生产交易在交易列表的 RPC 调用中表现为孤立。几个矿池误解了这些信息并且把这些区块叫作 “孤儿”，事实上这些区块都有父区块，可能还有子区块。</p>
<p>​ 因为一个区块只能引用一个父区块，因而不可能把两个已经分叉的块链合并。</p>
<p>​ 可以把块链算法用于非金融目的，请看：<a href="https://en.bitcoin.it/wiki/Alternative_chain">山寨块链</a> <a href="https://en.bitcoin.it/wiki/Alternative_chain">https://en.bitcoin.it/wiki/Alternative_chain</a>。</p>
<p>​ 块链以洪水协议被广播到网络上的所有节点，请看：<a href="https://en.bitcoin.it/wiki/Block_chain_download">块链下载</a></p>
<p>​ 译者按：区块成熟时间 (Maturation Time)，是指矿工产生一个新区块得到 25BTC 收益后，要等过了 100 个块后，才能使用这些币；这个 100 区块时间，即收到 100 个确认的时间，就是区块成熟时间。为什么要设这个时间？如果这个区块在分叉时变成了孤立区块，25 个 BTC 的收益将消失，如果矿工挖到比特币后可以马上花掉，就会造成后续的一系列接收者损失比特币，因而设定了 100 个确认的限制，在这之后产生分叉的可能性非常小，即使产生分叉，也只会影响矿工收益，不会影响到其他人。</p>
<h2 id="4区块-hash-算法-block-hashing-algorithm">4。区块 HASH 算法 (Block hashing Algorithm)</h2>
<p>当挖矿时，你会经常对区块头进行 HASH，你正在挖的区块也会时常更新，一个区域头包含以下数据项：</p>
<div style="overflow:auto">














































<table><thead><tr><th><strong>数据项****</strong></th><th><strong>目的</strong></th><th><strong>更新时间****</strong></th><th><strong>大小****</strong></th></tr></thead><tbody><tr><td>Version 版本</td><td>区域版本号</td><td>更新软件后，它指定了一个新版本号</td><td>4</td></tr><tr><td>hashPrevBlock 前一区块的 HASH</td><td>前一区块的 256 位 HASH 值</td><td>新的区块进来时</td><td>32</td></tr><tr><td>hashMerkleRoot<a href="https://en.bitcoin.it/wiki/Protocol_specification">Merkele 根节点</a>HASH 值</td><td>基于一个区块中所有交易的 256 位 HASH 值。</td><td>接受一个交易时</td><td>32</td></tr><tr><td>Time 时间戳</td><td>从 1970-01-01 00:00 UTC 开始到现在，以秒为单位的当前时间戳</td><td>每几秒就更新</td><td>4</td></tr><tr><td>Bits 当前目标 HASH 值</td><td>压缩格式的当前<a href="https://en.bitcoin.it/wiki/Target">目标 HASH 值</a></td><td>当<a href="https://en.bitcoin.it/wiki/Difficulty">挖矿难度</a>调整时</td><td>4</td></tr><tr><td>Nonce 随机数</td><td>从 0 开始的 32 位随机</td><td>产生 HASH 时 A (每次产生 HASH 随机数要增长)</td><td>4</td></tr></tbody></table></div>
<p>​ 区块内包含许多交易，它们通过 Merkle 根节点间接被 HASH，因为所有交易不可能直接被 HASH，HASH 包含一个交易的区块所花的时间，和 HASH 包含 1 万个交易的区块一样。</p>
<p>​ 目标 HASH 值的压缩格式是一个特殊的浮点编码类型，首字节是指数 (仅使用了 5 个最低位)，后 3 个字节是尾数，它能表示 256 位的数值。一个区块头的 SHA256 值必定要小于或等于目标 HASH 值，该区块才能被网络所接受，目标 HASH 越低，产生一个新区块的难度越大。</p>
<p>​ 上述大部分数据项对所有用户是一致的，可能在时间戳上有些区别。(译者按：该段的以下内容来自：) 如果当前区块的时间戳大于前 11 个区块的的平均时间戳，并且小于 “网络调整时间 (Network-Adjusted Time)”+2 小时，则认为该时间戳是有效的。其中的 “网络调整时间” 是指与你相连接的所有节点的平均时间。当节点 A 连接到节点 B 时，A 从 B 处得到一个 UTC 标准的时间戳，A 先转换成本地 UTC 标准时间保存起来，网络调整时间等于所有节点的本地 UTC 时间+所有相连节点的偏移量平均值，然而，该网络时间永远不会调整到超过本地系统时间 70 分钟以上。</p>
<p>​ Nonce 随机数通常不同，但是它以严格的线性方式增长，从 0 开始，每次 HASH 时都会增长，当 Nonce 溢出时 (此事经常发生)，生产交易的 extraNonce 项会增长，将改变 Merkle 树的根节点。</p>
<p>​ 假定针对这些数据项，人们经常会独自产生同样序列号的 HASH 值，最快的 CPU 通常会赢。然而，两人产生同样的 Merkle 根节点基本是 (或近似) 不可能的，因为区块中的第一个交易是生产交易并且 “发送” 到你的独一无二的比特币地址。因为你的区块与其他人的区块不同，产生的 HASH 也肯定 (近似肯定) 不同，你计算的每个 HASH 和网络中的其他人一样，都有同样的获胜机会。</p>
<p>​ 比特币使用：SHA256(SHA256 (区块头)) 计算 HASH，但你要注意字节序。</p>
<p>​ 例如：以下 python 代码用于计算某一区块的 HASH 值，使用 2011 年 6 月的区块号 125552 的最小 HASH 值。该区块头建立上述 6 个数据项之上，并且以十六进制的小端结尾方式连接在一起。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">>>></span><span style="color:#F97583"> import</span><span style="color:#E1E4E8"> hashlib</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#E1E4E8"> header_hex </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (“</span><span style="color:#79B8FF">0</span><span style="color:#FDAEB7;font-style:italic">1000000</span><span style="color:#E1E4E8">″ </span><span style="color:#F97583">+</span></span>
<span class="line"><span style="color:#E1E4E8">“</span><span style="color:#FDAEB7;font-style:italic">81cd02ab7e569e8bcd9317e2fe99f2de44d49ab2b8851ba4a308000000000000</span><span style="color:#E1E4E8">″ </span><span style="color:#F97583">+</span></span>
<span class="line"><span style="color:#E1E4E8">“e320b6c2fffc8d750423db8b1eb942ae710e951ed797f7affc8892b0f1fc122b” </span><span style="color:#F97583">+</span></span>
<span class="line"><span style="color:#E1E4E8">“c7f5d74d” </span><span style="color:#F97583">+</span></span>
<span class="line"><span style="color:#E1E4E8">“f2b9441a” </span><span style="color:#F97583">+</span></span>
<span class="line"><span style="color:#E1E4E8">“</span><span style="color:#FDAEB7;font-style:italic">42a14695</span><span style="color:#E1E4E8">″)</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#E1E4E8"> header_bin </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> header_hex.decode(‘</span><span style="color:#79B8FF">hex</span><span style="color:#E1E4E8">’)</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#79B8FF"> hash</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> hashlib.sha256(hashlib.sha256(header_bin).digest()).digest()</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#79B8FF"> hash</span><span style="color:#E1E4E8">.encode(‘hex_codec’)</span></span>
<span class="line"><span style="color:#E1E4E8">’</span><span style="color:#FDAEB7;font-style:italic">1dbd981fe6985776b644b173a4d0385ddc1aa2a829688d1e0000000000000000</span><span style="color:#E1E4E8">′</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#79B8FF"> hash</span><span style="color:#E1E4E8">[::</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">].encode(‘hex_codec’)</span></span>
<span class="line"><span style="color:#E1E4E8">’</span><span style="color:#FDAEB7;font-style:italic">00000000000000001e8d6829a8a21adc5d38d0a473b144b6765798e61f98bd1d</span><span style="color:#E1E4E8">’</span></span></code></pre>
<p>​ 注意：实际的 HASH 值是一串 256 位的数值，首部有许多零。当以大头端十六进制常数方式打印或存贮时，它的首部有许多零；如果它以小头端打印或存贮，零就会变换到尾部。例如：如果表示成字节串-最低 (或者开头) 的字节串地址显示最小位的数，这样就是小头端表示。<a href="http://blockexplorer.com/">blockexplorer</a> 的输出把 HASH 值显示为大头端表示的数值，因为数字的表示通常是-首部数字是最大数字，从左向右读。</p>
<p>举另外一个例子：<a href="http://pastebin.com/bW3fQA2a">这儿</a>是纯 C 版本，未进行任何优化、线程化和错误检查。</p>
<p>以下是同样的例子，用 PHP 写，没有任何优化。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">&#x3C;?</span></span>
<span class="line"><span style="color:#6A737D">//This reverses and then swaps every other char</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> SwapOrder</span><span style="color:#E1E4E8">($in){</span></span>
<span class="line"><span style="color:#E1E4E8">  $Split </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> str_split</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">strrev</span><span style="color:#E1E4E8">($in));</span></span>
<span class="line"><span style="color:#E1E4E8">  $x</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  for</span><span style="color:#E1E4E8"> ($i </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; $i </span><span style="color:#F97583">&#x3C;</span><span style="color:#79B8FF"> count</span><span style="color:#E1E4E8">($Split); $i</span><span style="color:#F97583">+=</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">   $x </span><span style="color:#F97583">.=</span><span style="color:#E1E4E8"> $Split[$i</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">.</span><span style="color:#E1E4E8">$Split[$i];</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> $x;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">//makes the littleEndian</span></span>
<span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> littleEndian</span><span style="color:#E1E4E8">($value){</span></span>
<span class="line"><span style="color:#F97583"> return</span><span style="color:#79B8FF"> implode</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">unpack</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">‘H</span><span style="color:#F97583">*</span><span style="color:#79B8FF">’</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">pack</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">“V</span><span style="color:#F97583">*</span><span style="color:#79B8FF">”</span><span style="color:#E1E4E8">,$value)));</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">$version </span><span style="color:#F97583">=</span><span style="color:#B392F0"> littleEndian</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">$prevBlockHash </span><span style="color:#F97583">=</span><span style="color:#B392F0"> SwapOrder</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">’00000000000008a3a41b85b8b29ad444def299fee21793cd8b9e567eab02cd81′</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">$rootHash </span><span style="color:#F97583">=</span><span style="color:#B392F0"> SwapOrder</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">’2b12fcf1b09288fcaff797d71e950e71ae42b91e8bdb2304758dfcffc2b620e3′</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">$time </span><span style="color:#F97583">=</span><span style="color:#B392F0"> littleEndian</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1305998791</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">$bits </span><span style="color:#F97583">=</span><span style="color:#B392F0">littleEndian</span><span style="color:#E1E4E8">( </span><span style="color:#79B8FF">440711666</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">$nonce </span><span style="color:#F97583">=</span><span style="color:#B392F0"> littleEndian</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2504433986</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">//concat it all</span></span>
<span class="line"><span style="color:#E1E4E8">$header_hex </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> $version </span><span style="color:#F97583">.</span><span style="color:#E1E4E8"> $prevBlockHash </span><span style="color:#F97583">.</span><span style="color:#E1E4E8"> $rootHash </span><span style="color:#F97583">.</span><span style="color:#E1E4E8"> $time </span><span style="color:#F97583">.</span><span style="color:#E1E4E8"> $bits </span><span style="color:#F97583">.</span><span style="color:#E1E4E8"> $nonce;</span></span>
<span class="line"><span style="color:#6A737D">//convert from hex to binary</span></span>
<span class="line"><span style="color:#E1E4E8">$header_bin  </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> hex2bin</span><span style="color:#E1E4E8">($header_hex);</span></span>
<span class="line"><span style="color:#6A737D">//hash it then convert from hex to binary</span></span>
<span class="line"><span style="color:#E1E4E8">$pass1 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> hex2bin</span><span style="color:#E1E4E8">(  </span><span style="color:#79B8FF">hash</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">‘sha256′</span><span style="color:#E1E4E8">, $header_bin )  );</span></span>
<span class="line"><span style="color:#6A737D">//Hash it for the seconded time</span></span>
<span class="line"><span style="color:#E1E4E8">$pass2 </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> hash</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">‘sha256′</span><span style="color:#E1E4E8">, $pass1);</span></span>
<span class="line"><span style="color:#6A737D">//fix the order</span></span>
<span class="line"><span style="color:#E1E4E8">$FinalHash </span><span style="color:#F97583">=</span><span style="color:#B392F0"> SwapOrder</span><span style="color:#E1E4E8">($pass2);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">echo</span><span style="color:#E1E4E8">   $FinalHash;</span></span>
<span class="line"><span style="color:#F97583">?></span></span></code></pre>
<h2 id="5难度-difficulty">5。难度 (Difficulty)</h2>
<p>​ 难度是对挖矿困难程度的度量，即指：计算符合给定目标的一个 HASH 值的困难程度。比特币网络有一个全局的区块难度，有效的区域必须有一个 HASH 值，该 HASH 值必须小于给定的目标 HASH。矿池也会有一个自定义的共享难度用来设定产生股份的最低难度限制。</p>
<p>​ 难度每过 2016 块改变一次，计算公式：<code>difficulty = difficulty_1_target / current_target</code>。目标 (target) 是一个 256 位长的数值。</p>
<p>​ 有许多不同测量难度的方法，得到的 difficulty_1_target 可能不同。传统地，它表示一个 HASH 值，前 32 位为 0，后续部分为 1 (称之为：矿池难度或 pdiff)，比特币协议把目标 HASH 表示成一个固定精度的自定义浮点类型，因而，比特币客户端用该值来估计难度 (称之为：bdiff)。</p>
<p>​ 难度经常被存贮在区块中，每个块存贮一个十六制的目标 HASH 的压缩表达式 (称之为：Bits)，目标 HASH 可以以预先定义的公式计算出来。例如：如果区块中压缩的目标 HASH 为 0x1b0404cb，那十六进制的目标 HASH 如下所示：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>0x0404cb * 2^(8*(0x1b - 3)) = 0x00000000000404CB000000000000000000000000000000000000000000000000</span></span></code></pre>
<p>因而目标 HASH 为 0x1b0404cb 时，难度为：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>0x00000000FFFF0000000000000000000000000000000000000000000000000000 /</span></span>
<span class="line"><span>0x00000000000404CB000000000000000000000000000000000000000000000000</span></span>
<span class="line"><span>= 16307.420938523983 (bdiff)</span></span></code></pre>
<p>或者：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>0x00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF /</span></span>
<span class="line"><span>0x00000000000404CB000000000000000000000000000000000000000000000000</span></span>
<span class="line"><span>= 16307.669773817162 (pdiff)</span></span></code></pre>
<p>其中：<code>0x00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</code> 是挖矿机使用的最大目标 HASH 值。</p>
<p>而 <code>0x00000000FFFF0000000000000000000000000000000000000000000000000000</code> 则是比特币网络使用的浮点编码类型，后面的位数被缩短。</p>
<p>​ 下面是一个快速计算比特币难度的方法，它的算法使用修改的泰勒序列 (你可以看 wikipedia 上的教程)，并且依赖记录来转换难度计算。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &#x3C;iostream></span></span>
<span class="line"><span style="color:#F97583">#include</span><span style="color:#9ECBFF"> &#x3C;cmath></span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">inline</span><span style="color:#F97583"> float</span><span style="color:#B392F0"> fast_log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">float</span><span style="color:#FFAB70"> val</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">  int</span><span style="color:#F97583"> *</span><span style="color:#F97583"> const</span><span style="color:#E1E4E8"> exp_ptr </span><span style="color:#F97583">=</span><span style="color:#F97583"> reinterpret_cast</span><span style="color:#F97583"> &#x3C;int</span><span style="color:#F97583"> *></span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&#x26;</span><span style="color:#E1E4E8">val);</span></span>
<span class="line"><span style="color:#F97583">  int</span><span style="color:#E1E4E8"> x </span><span style="color:#F97583">=</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8">exp_ptr;</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> log_2 </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ((x </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 23</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x26;</span><span style="color:#79B8FF"> 255</span><span style="color:#E1E4E8">) – </span><span style="color:#79B8FF">128</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  x </span><span style="color:#F97583">&#x26;=</span><span style="color:#F97583"> ~</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">255</span><span style="color:#F97583"> &#x3C;&#x3C;</span><span style="color:#79B8FF"> 23</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  x </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 127</span><span style="color:#F97583"> &#x3C;&#x3C;</span><span style="color:#79B8FF"> 23</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  *</span><span style="color:#E1E4E8">exp_ptr </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> x;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  val </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ((</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1.0</span><span style="color:#F97583">f/</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> val </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> val – </span><span style="color:#79B8FF">2.0</span><span style="color:#F97583">f/</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> ((val </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> log_2) </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 0.69314718</span><span style="color:#F97583">f</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">float</span><span style="color:#B392F0"> difficulty</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">unsigned</span><span style="color:#F97583"> int</span><span style="color:#FFAB70"> bits</span><span style="color:#E1E4E8">){</span></span>
<span class="line"><span style="color:#F97583">  static</span><span style="color:#F97583"> double</span><span style="color:#E1E4E8"> max_body </span><span style="color:#F97583">=</span><span style="color:#B392F0"> fast_log</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00ffff</span><span style="color:#E1E4E8">), scaland </span><span style="color:#F97583">=</span><span style="color:#B392F0"> fast_log</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">256</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#B392F0"> exp</span><span style="color:#E1E4E8">(max_body – </span><span style="color:#B392F0">fast_log</span><span style="color:#E1E4E8">(bits </span><span style="color:#F97583">&#x26;</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">00ffffff</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> scaland </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1d</span><span style="color:#E1E4E8"> – ((bits </span><span style="color:#F97583">&#x26;</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">ff000000</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">>></span><span style="color:#79B8FF"> 24</span><span style="color:#E1E4E8">)));</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">int</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">(){</span></span>
<span class="line"><span style="color:#B392F0"> std</span><span style="color:#E1E4E8">::cout </span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#B392F0"> difficulty</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1b0404cb</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&#x3C;&#x3C;</span><span style="color:#B392F0"> std</span><span style="color:#E1E4E8">::endl;</span></span>
<span class="line"><span style="color:#F97583"> return</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>如果要看以上一般难度计算的数字原理，以下是 python 代码：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> decimal, math</span></span>
<span class="line"><span style="color:#E1E4E8">l </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> math.log</span></span>
<span class="line"><span style="color:#E1E4E8">e </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> math.e</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#F97583"> 0x</span><span style="color:#79B8FF">00ffff</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583">**</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1d</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> float</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0404cb</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583">**</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1b</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)))</span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8"> l(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00ffff</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583">**</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1d</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">/</span><span style="color:#79B8FF"> float</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0404cb</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583">**</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1b</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">))))</span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8"> l(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00ffff</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583">**</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1d</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">))) – l(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0404cb</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 2</span><span style="color:#F97583">**</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1b</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)))</span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8"> l(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00ffff</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> l(</span><span style="color:#79B8FF">2</span><span style="color:#F97583">**</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1d</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">))) – l(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0404cb</span><span style="color:#E1E4E8">) – l(</span><span style="color:#79B8FF">2</span><span style="color:#F97583">**</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1b</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)))</span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8"> l(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00ffff</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1d</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">))</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">l(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) – l(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0404cb</span><span style="color:#E1E4E8">) – (</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1b</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">))</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">l(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8"> l(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00ffff</span><span style="color:#F97583"> /</span><span style="color:#79B8FF"> float</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0404cb</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1d</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">))</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">l(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">) – (</span><span style="color:#79B8FF">8</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1b</span><span style="color:#E1E4E8"> – </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">))</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">l(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8"> l(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">00ffff</span><span style="color:#F97583"> /</span><span style="color:#79B8FF"> float</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">0404cb</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1d</span><span style="color:#E1E4E8"> – </span><span style="color:#F97583">0x</span><span style="color:#79B8FF">1b</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">*</span><span style="color:#E1E4E8">l(</span><span style="color:#79B8FF">2</span><span style="color:#F97583">**</span><span style="color:#79B8FF">8</span><span style="color:#E1E4E8">)</span></span></code></pre>
<p>​ 目前难度可以通过 <a href="http://blockexplorer.com/q/getdifficulty">http://blockexplorer.com/q/getdifficulty</a> 来得到，下一个难度可以通过 <a href="http://blockexplorer.com/q/estimate">http://blockexplorer.com/q/estimate</a> 来获得。难度的变化情况可以查看 <a href="http://bitcoin.sipa.be/">http://bitcoin.sipa.be/</a>。</p>
<p>​ 最大难度大约=maximum_target / 1 (因为 0 会导致无穷大)，这是一个非常大的数值，大约 2^224；当 maximum_target 为最小 1 时，最小难度值为 1。</p>
<p>​ 难度根据以前 2016 个区块的产生时间，每 2016 块改变一次。预计每隔 10 分钟产生一个区块，因而产生 2016 个区块要花费 2 周时间。如果前 2016 个区块的产生时间多于两周，则难度会降低；否则难度就会增加。</p>
<p>​ 为了找到新区块，该区块的 HASH 值必须小于目标 HASH 傎，实际上是一个在 0 到 2^256-1 之间的随机数，难度 1 的偏移量是：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>0xffff * 2^208</span></span></code></pre>
<p>难度 D 的偏移量是</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>(0xffff * 2^208)/D</span></span></code></pre>
<p>在难度 D 下，为了找到新区块，我们预期要计算的 HASH 数量是</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>D * 2^256 / (0xffff * 2^208)</span></span></code></pre>
<p>或者只是</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>D * 2^48 / 0xffff</span></span></code></pre>
<p>​ 难度的设定，是为了以每 10 分钟一个区块的产生速度产生 2016 个区块，因而我们在 600 秒内计算 (D * 2^48 / 0xffff) 个 HASH，这就意味着产生 2016 个区块的网络 HASH 速率 (算力) 是</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>D * 2^48 / 0xffff / 600</span></span></code></pre>
<p>可以进一步简化为：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>D * 2^32 / 600</span></span></code></pre>
<p>以上公式有较好的精度。</p>
<p>​ 在难度 1 下，算力是 7Mhashes/秒，译者在翻译这篇文章时难度是 5,006,860,589，这就意味着以前 2016 个区块被找到，其平均算力是：35.840PHash/s。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>5,006,860,589 * 2^32 / 600 = 大约在35.840 PHash/s</span></span></code></pre>
<p>发现一个区块的平均时间，可以用以下公式估计：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>时间 = 难度 * 2^32 / 算力</span></span></code></pre>
<p>​ 其中，难度是当前的难度，算力你的矿机的计算能力，是 hashes/s 为单位，时间是你找到的两个区块之间的平均时间。举例：使用 Python 计算，算力为 1Ghashes/s 的矿机，难度在 20000 时，产生一个新区块的时间，(其中**表示指数)：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span>$ python -c "print 20000 * 2**32 / 10**9 / 60 / 60.0"</span></span>
<span class="line"><span>23.85</span></span></code></pre>
<p>意思就是：找到一个新区块要花费近 1 小时。</p>
<p><a href="https://en.bitcoin.it/wiki/Mining_Hardware_Comparison">挖矿硬件对比</a>，这里有一些统计，可以帮助你预测收入。</p>
<p><a href="http://www.alloscomp.com/bitcoin/calculator.php">收支计算器 1</a>，<a href="http://www.vnbitcoin.org/bitcoincalculator.php">收支计算器 2</a>，能帮你计算收支。</p>
<p>记住：这只是可能性，并不能保证你每天都能找到新区块。建议加入矿池挖矿，通过共享区块收益的方式，能得到稳定长期的回报。</p>
<h2 id="本文译自比特币-wiki">本文译自比特币 WIKI</h2>
<ul>
<li><a href="https://en.bitcoin.it/wiki/Block_chain">https://en.bitcoin.it/wiki/Block_chain</a></li>
<li><a href="https://en.bitcoin.it/wiki/Block">https://en.bitcoin.it/wiki/Block</a></li>
<li><a href="https://en.bitcoin.it/wiki/Block_hashing_algorithm">https://en.bitcoin.it/wiki/Block_hashing_algorithm</a></li>
<li><a href="https://en.bitcoin.it/wiki/Genesis_block">https://en.bitcoin.it/wiki/Genesis_block</a></li>
<li><a href="https://en.bitcoin.it/wiki/Nonstandard_block">https://en.bitcoin.it/wiki/Nonstandard_block</a></li>
<li><a href="https://en.bitcoin.it/wiki/Difficulty">https://en.bitcoin.it/wiki/Difficulty</a></li>
<li><a href="https://en.bitcoin.it/wiki/Target">https://en.bitcoin.it/wiki/Target</a></li>
</ul> </div> <div class="mx-auto px-6 sm:px-6 max-w-3xl mt-8 flex justify-between flex-col sm:flex-row"> <ul class="mr-5 rtl:mr-0 rtl:ml-5"><li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 rtl:mr-0 rtl:ml-2 mb-2 py-0.5 px-2 font-medium"><a href="/tag/BTC" class="text-muted dark:text-slate-300 hover:text-primary dark:hover:text-gray-200">BTC</a></li><li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 rtl:mr-0 rtl:ml-2 mb-2 py-0.5 px-2 font-medium"><a href="/tag/基础知识" class="text-muted dark:text-slate-300 hover:text-primary dark:hover:text-gray-200">基础知识</a></li></ul> <div class="mt-5 sm:mt-1 align-middle text-gray-500 dark:text-slate-600"> <span class="align-super font-bold text-gray-400 dark:text-slate-400">Share:</span> <button class="ml-2 rtl:ml-0 rtl:mr-2" title="Twitter Share" data-aw-social-share="twitter" data-aw-url="https://dataagg.github.io/btcminning" data-aw-text="比特币块链和挖矿原理(修订版)"><svg width="1em" height="1em" viewBox="0 0 24 24" class="w-6 h-6 text-gray-400 dark:text-slate-500 hover:text-black dark:hover:text-slate-300" data-icon="tabler:brand-x">   <use  xlink:href="#ai:tabler:brand-x"></use> </svg> </button> <button class="ml-2 rtl:ml-0 rtl:mr-2" title="Facebook Share" data-aw-social-share="facebook" data-aw-url="https://dataagg.github.io/btcminning"><svg width="1em" height="1em" viewBox="0 0 24 24" class="w-6 h-6 text-gray-400 dark:text-slate-500 hover:text-black dark:hover:text-slate-300" data-icon="tabler:brand-facebook">  <symbol id="ai:tabler:brand-facebook"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 0 1 1-1h3V3h-3a5 5 0 0 0-5 5v2z"/></symbol> <use  xlink:href="#ai:tabler:brand-facebook"></use> </svg> </button> <button class="ml-2 rtl:ml-0 rtl:mr-2" title="Linkedin Share" data-aw-social-share="linkedin" data-aw-url="https://dataagg.github.io/btcminning" data-aw-text="比特币块链和挖矿原理(修订版)"><svg width="1em" height="1em" viewBox="0 0 24 24" class="w-6 h-6 text-gray-400 dark:text-slate-500 hover:text-black dark:hover:text-slate-300" data-icon="tabler:brand-linkedin">  <symbol id="ai:tabler:brand-linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm4 5v5m0-8v.01M12 16v-5"/><path d="M16 16v-3a2 2 0 0 0-4 0"/></g></symbol> <use  xlink:href="#ai:tabler:brand-linkedin"></use> </svg> </button> <button class="ml-2 rtl:ml-0 rtl:mr-2" title="Whatsapp Share" data-aw-social-share="whatsapp" data-aw-url="https://dataagg.github.io/btcminning" data-aw-text="比特币块链和挖矿原理(修订版)"><svg width="1em" height="1em" viewBox="0 0 24 24" class="w-6 h-6 text-gray-400 dark:text-slate-500 hover:text-black dark:hover:text-slate-300" data-icon="tabler:brand-whatsapp">  <symbol id="ai:tabler:brand-whatsapp"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m3 21l1.65-3.8a9 9 0 1 1 3.4 2.9z"/><path d="M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0za5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1"/></g></symbol> <use  xlink:href="#ai:tabler:brand-whatsapp"></use> </svg> </button> <button class="ml-2 rtl:ml-0 rtl:mr-2" title="Email Share" data-aw-social-share="mail" data-aw-url="https://dataagg.github.io/btcminning" data-aw-text="比特币块链和挖矿原理(修订版)"><svg width="1em" height="1em" viewBox="0 0 24 24" class="w-6 h-6 text-gray-400 dark:text-slate-500 hover:text-black dark:hover:text-slate-300" data-icon="tabler:mail">  <symbol id="ai:tabler:mail"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="m3 7l9 6l9-6"/></g></symbol> <use  xlink:href="#ai:tabler:mail"></use> </svg> </button> </div> </div> </article> </section> <div class="mx-auto px-6 sm:px-6 max-w-3xl pt-8 md:pt-4 pb-12 md:pb-20"> <a class="btn btn-tertiary px-3 md:px-3" href="/blog"><svg width="1em" height="1em" viewBox="0 0 24 24" class="w-5 h-5 mr-1 -ml-1.5 rtl:-mr-1.5 rtl:ml-1" data-icon="tabler:chevron-left">  <symbol id="ai:tabler:chevron-left"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 6l-6 6l6 6"/></symbol> <use  xlink:href="#ai:tabler:chevron-left"></use> </svg> Back to Blog
</a> </div>  </main>  <footer class="relative border-t border-gray-200 dark:border-slate-800 not-prose"> <div class="dark:bg-dark absolute inset-0 pointer-events-none" aria-hidden="true"></div> <div class="relative max-w-7xl mx-auto px-4 sm:px-6 dark:text-slate-300"> <div class="grid grid-cols-12 gap-4 gap-y-8 sm:gap-8 py-8 md:py-12"> <div class="col-span-12 lg:col-span-4"> <div class="mb-2"> <a class="inline-block font-bold text-xl" href="/">TokenAgg DAO</a> </div> <div class="text-sm text-muted"> <a class="text-muted hover:text-gray-700 dark:text-gray-400 hover:underline transition duration-150 ease-in-out mr-2 rtl:mr-0 rtl:ml-2" href="/terms">通用条款</a><a class="text-muted hover:text-gray-700 dark:text-gray-400 hover:underline transition duration-150 ease-in-out mr-2 rtl:mr-0 rtl:ml-2" href="/privacy">隐私协议</a> </div> </div> <div class="col-span-6 md:col-span-3 lg:col-span-2"> <div class="dark:text-gray-300 font-medium mb-2">项目</div> <ul class="text-sm"> <li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/project/index.html?id=001"> TokenAgg DAO </a> </li><li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/project/index.html?id=012"> DApp Admin </a> </li> </ul> </div><div class="col-span-6 md:col-span-3 lg:col-span-2"> <div class="dark:text-gray-300 font-medium mb-2">解决方案</div> <ul class="text-sm"> <li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/solution1"> 生鲜配送 </a> </li><li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/solution2"> 诊所联盟 </a> </li><li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/solution3"> 妙蛙云池 </a> </li> </ul> </div><div class="col-span-6 md:col-span-3 lg:col-span-2"> <div class="dark:text-gray-300 font-medium mb-2">公司</div> <ul class="text-sm"> <li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/teams"> 关于我们 </a> </li><li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/intro"> 公司价值 </a> </li><li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/story"> 成功案例 </a> </li><li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/privacy"> 隐私条款 </a> </li> </ul> </div><div class="col-span-6 md:col-span-3 lg:col-span-2"> <div class="dark:text-gray-300 font-medium mb-2">博客</div> <ul class="text-sm"> <li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/category/项目推荐"> 项目推荐 </a> </li><li class="mb-2"> <a class="text-muted hover:text-gray-700 hover:underline dark:text-gray-400 transition duration-150 ease-in-out" href="/category/基础知识"> 基础知识 </a> </li> </ul> </div> </div> <div class="md:flex md:items-center md:justify-between py-6 md:py-8"> <ul class="flex mb-4 md:order-1 -ml-2 md:ml-4 md:mb-0 rtl:ml-0 rtl:-mr-2 rtl:md:ml-0 rtl:md:mr-4"> <li> <a class="text-muted dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="X" href="https://twitter.com/watano"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-5 h-5" data-icon="tabler:brand-x">  <symbol id="ai:tabler:brand-x"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m4 4l11.733 16H20L8.267 4zm0 16l6.768-6.768m2.46-2.46L20 4"/></symbol> <use  xlink:href="#ai:tabler:brand-x"></use> </svg>   </a> </li><li> <a class="text-muted dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="RSS" href="/rss.xml"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-5 h-5" data-icon="tabler:rss">   <use  xlink:href="#ai:tabler:rss"></use> </svg>   </a> </li><li> <a class="text-muted dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Github" href="https://github.com/dataagg"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="w-5 h-5" data-icon="tabler:brand-github">  <symbol id="ai:tabler:brand-github"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2c2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2a4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6c-.6.6-.6 1.2-.5 2V21"/></symbol> <use  xlink:href="#ai:tabler:brand-github"></use> </svg>   </a> </li><li> <a class="text-muted dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 inline-flex items-center" aria-label="Mirror" href="https://mirror.xyz/0x94c0e8cf59e644fa76d4fa83164b9f2030d07f31">  <img src="/imgs/icon-mirror.png" class="w-5 h-5" alt="">  </a> </li> </ul> <div class="text-sm mr-4 dark:text-slate-400"> Made by <a class="text-blue-600 hover:underline dark:text-gray-200" href="https://github.com/dataagg"> DataAgg</a> · All rights reserved.   </div> </div> </div> </footer>   <script>(function(){const defaultTheme = "dark";

  if (window.basic_script) {
    return;
  }

  window.basic_script = true;

  function applyTheme(theme) {
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  const initTheme = function () {
    if ((defaultTheme && defaultTheme.endsWith(':only')) || (!localStorage.theme && defaultTheme !== 'system')) {
      applyTheme(defaultTheme.replace(':only', ''));
    } else if (
      localStorage.theme === 'dark' ||
      (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      applyTheme('dark');
    } else {
      applyTheme('light');
    }
  };
  initTheme();

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  const onLoad = function () {
    let lastKnownScrollPosition = window.scrollY;
    let ticking = true;

    attachEvent('#header nav', 'click', function () {
      document.querySelector('[data-aw-toggle-menu]')?.classList.remove('expanded');
      document.body.classList.remove('overflow-hidden');
      document.getElementById('header')?.classList.remove('h-screen');
      document.getElementById('header')?.classList.remove('expanded');
      document.getElementById('header')?.classList.remove('bg-page');
      document.querySelector('#header nav')?.classList.add('hidden');
      document.querySelector('#header > div > div:last-child')?.classList.add('hidden');
    });

    attachEvent('[data-aw-toggle-menu]', 'click', function (_, elem) {
      elem.classList.toggle('expanded');
      document.body.classList.toggle('overflow-hidden');
      document.getElementById('header')?.classList.toggle('h-screen');
      document.getElementById('header')?.classList.toggle('expanded');
      document.getElementById('header')?.classList.toggle('bg-page');
      document.querySelector('#header nav')?.classList.toggle('hidden');
      document.querySelector('#header > div > div:last-child')?.classList.toggle('hidden');
    });

    attachEvent('[data-aw-toggle-color-scheme]', 'click', function () {
      if (defaultTheme.endsWith(':only')) {
        return;
      }
      document.documentElement.classList.toggle('dark');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    });

    attachEvent('[data-aw-social-share]', 'click', function (_, elem) {
      const network = elem.getAttribute('data-aw-social-share');
      const url = encodeURIComponent(elem.getAttribute('data-aw-url'));
      const text = encodeURIComponent(elem.getAttribute('data-aw-text'));

      let href;
      switch (network) {
        case 'facebook':
          href = `https://www.facebook.com/sharer.php?u=${url}`;
          break;
        case 'twitter':
          href = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
          break;
        case 'linkedin':
          href = `https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${text}`;
          break;
        case 'whatsapp':
          href = `https://wa.me/?text=${text}%20${url}`;
          break;
        case 'mail':
          href = `mailto:?subject=%22${text}%22&body=${text}%20${url}`;
          break;

        default:
          return;
      }

      const newlink = document.createElement('a');
      newlink.target = '_blank';
      newlink.href = href;
      newlink.click();
    });

    function appyHeaderStylesOnScroll() {
      const header = document.querySelector('#header[data-aw-sticky-header]');
      if (lastKnownScrollPosition > 60 && !header.classList.contains('scroll')) {
        document.getElementById('header').classList.add('scroll');
      } else if (lastKnownScrollPosition <= 60 && header.classList.contains('scroll')) {
        document.getElementById('header').classList.remove('scroll');
      }
      ticking = false;
    }
    appyHeaderStylesOnScroll();

    attachEvent([document], 'scroll', function () {
      lastKnownScrollPosition = window.scrollY;

      if (!ticking) {
        window.requestAnimationFrame(() => {
          appyHeaderStylesOnScroll();
        });
        ticking = true;
      }
    });
  };
  const onPageShow = function () {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
    const elem = document.querySelector('[data-aw-toggle-menu]');
    if (elem) {
      elem.classList.remove('expanded');
    }
    document.body.classList.remove('overflow-hidden');
    document.getElementById('header')?.classList.remove('h-screen');
    document.getElementById('header')?.classList.remove('expanded');
    document.querySelector('#header nav')?.classList.add('hidden');
  };

  window.onload = onLoad;
  window.onpageshow = onPageShow;

  document.addEventListener('astro:after-swap', () => {
    initTheme();
    onLoad();
    onPageShow();
  });
})();</script>  </body> </html>