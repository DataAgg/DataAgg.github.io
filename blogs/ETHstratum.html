<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>以太坊 stratum 协议原理 | 妙蛙云池</title>
    <meta name="description" content="专注于去中心化存储服务提供的区块链行业解决方案提供商">
    <link rel="stylesheet" href="/assets/style.45e384d0.css">
    <link rel="modulepreload" href="/assets/Home.edf45a40.js">
    <link rel="modulepreload" href="/assets/app.99e6884a.js">
    <link rel="modulepreload" href="/assets/blogs_ETHstratum.md.b9e35113.lean.js">
    
    <meta name="author" content="watano">
  <meta name="keywords" content="mewa,mewapool,mewa pool,filecoin,filcoin miner">
  <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta name="twitter:title" content="以太坊 stratum 协议原理 | 妙蛙云池">
  <meta property="og:title" content="以太坊 stratum 协议原理 | 妙蛙云池">
  </head>
  <body>
    <div id="app"><div class="theme"><header class="nav-bar" data-v-eacf8434><div class="sidebar-button" data-v-eacf8434><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="妙蛙云池, back to home" data-v-eacf8434 data-v-2e7d3e70><img class="logo" src="/logo.png" alt="Logo" data-v-2e7d3e70> 妙蛙云池</a><div class="flex-grow" data-v-eacf8434></div><div class="nav" data-v-eacf8434><nav class="nav-links" data-v-eacf8434 data-v-7c9afbaa><!--[--><div class="item" data-v-7c9afbaa><div class="nav-dropdown-link" data-v-7c9afbaa data-v-121c5160><button class="button" data-v-121c5160><span class="button-text" data-v-121c5160>产品</span><span class="right button-arrow" data-v-121c5160></span></button><ul class="dialog" data-v-121c5160><!--[--><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/products/product1" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>满存算力</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/products/product2" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>联挖整机</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-7c9afbaa><div class="nav-dropdown-link" data-v-7c9afbaa data-v-121c5160><button class="button" data-v-121c5160><span class="button-text" data-v-121c5160>行业解决方案</span><span class="right button-arrow" data-v-121c5160></span></button><ul class="dialog" data-v-121c5160><!--[--><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/service/intro" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>综述</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/service/solution1" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>生鲜配送</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/service/solution2" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>诊所联盟</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-7c9afbaa><div class="nav-dropdown-link" data-v-7c9afbaa data-v-121c5160><button class="button" data-v-121c5160><span class="button-text" data-v-121c5160>DeFi</span><span class="right button-arrow" data-v-121c5160></span></button><ul class="dialog" data-v-121c5160><!--[--><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/defi/ohmCalc" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>OlympusDAO计算器</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/defi/timeCalc" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>Wonderland计算器</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-7c9afbaa><div class="nav-dropdown-link" data-v-7c9afbaa data-v-121c5160><button class="button" data-v-121c5160><span class="button-text" data-v-121c5160>关于我们</span><span class="right button-arrow" data-v-121c5160></span></button><ul class="dialog" data-v-121c5160><!--[--><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/other/teams" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>公司与团队</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/other/story" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>成功案例</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><!--]--></ul></div></div><!--]--><!----><!----><div class="item" data-v-7c9afbaa><button class="nav-btn" aria-label="Toggle Theme" data-v-7c9afbaa><svg width="1.2em" height="1.2em" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" style="display:none;"><path d="M21.64 13a1 1 0 0 0-1.05-.14a8.05 8.05 0 0 1-3.37.73a8.15 8.15 0 0 1-8.14-8.1a8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69a1 1 0 0 0-.36-1.05zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14a9.79 9.79 0 0 0 2.1-.22a8.11 8.11 0 0 1-7.18 4.32z" fill="currentColor"></path></svg><svg width="1.2em" height="1.2em" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" style=""><path d="M5.64 17l-.71.71a1 1 0 0 0 0 1.41a1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17zM5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1zm7-7a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1zM5.64 7.05a1 1 0 0 0 .7.29a1 1 0 0 0 .71-.29a1 1 0 0 0 0-1.41l-.71-.71a1 1 0 0 0-1.41 1.41zm12 .29a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.64.71a1 1 0 0 0 0 1.41a1 1 0 0 0 .66.29zM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2zm-9 8a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1zm6.36-2A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0a1 1 0 0 0 0-1.41zM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5zm0 9a3.5 3.5 0 1 1 3.5-3.5a3.5 3.5 0 0 1-3.5 3.5z" fill="currentColor"></path></svg></button></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-34e9bec6><nav class="nav-links nav" data-v-34e9bec6 data-v-7c9afbaa><!--[--><div class="item" data-v-7c9afbaa><div class="nav-dropdown-link" data-v-7c9afbaa data-v-121c5160><button class="button" data-v-121c5160><span class="button-text" data-v-121c5160>产品</span><span class="right button-arrow" data-v-121c5160></span></button><ul class="dialog" data-v-121c5160><!--[--><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/products/product1" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>满存算力</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/products/product2" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>联挖整机</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-7c9afbaa><div class="nav-dropdown-link" data-v-7c9afbaa data-v-121c5160><button class="button" data-v-121c5160><span class="button-text" data-v-121c5160>行业解决方案</span><span class="right button-arrow" data-v-121c5160></span></button><ul class="dialog" data-v-121c5160><!--[--><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/service/intro" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>综述</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/service/solution1" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>生鲜配送</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/service/solution2" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>诊所联盟</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-7c9afbaa><div class="nav-dropdown-link" data-v-7c9afbaa data-v-121c5160><button class="button" data-v-121c5160><span class="button-text" data-v-121c5160>DeFi</span><span class="right button-arrow" data-v-121c5160></span></button><ul class="dialog" data-v-121c5160><!--[--><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/defi/ohmCalc" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>OlympusDAO计算器</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/defi/timeCalc" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>Wonderland计算器</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-7c9afbaa><div class="nav-dropdown-link" data-v-7c9afbaa data-v-121c5160><button class="button" data-v-121c5160><span class="button-text" data-v-121c5160>关于我们</span><span class="right button-arrow" data-v-121c5160></span></button><ul class="dialog" data-v-121c5160><!--[--><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/other/teams" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>公司与团队</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><li class="dialog-item" data-v-121c5160><div class="nav-dropdown-link-item" data-v-121c5160 data-v-17dca46e><a class="item" href="/other/story" data-v-17dca46e><span class="arrow" data-v-17dca46e></span><span class="text" data-v-17dca46e>成功案例</span><span class="icon" data-v-17dca46e><!----></span></a></div></li><!--]--></ul></div></div><!--]--><!----><!----><div class="item" data-v-7c9afbaa><button class="nav-btn" aria-label="Toggle Theme" data-v-7c9afbaa><svg width="1.2em" height="1.2em" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" style="display:none;"><path d="M21.64 13a1 1 0 0 0-1.05-.14a8.05 8.05 0 0 1-3.37.73a8.15 8.15 0 0 1-8.14-8.1a8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69a1 1 0 0 0-.36-1.05zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14a9.79 9.79 0 0 0 2.1-.22a8.11 8.11 0 0 1-7.18 4.32z" fill="currentColor"></path></svg><svg width="1.2em" height="1.2em" preserveaspectratio="xMidYMid meet" viewbox="0 0 24 24" style=""><path d="M5.64 17l-.71.71a1 1 0 0 0 0 1.41a1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17zM5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1zm7-7a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1zM5.64 7.05a1 1 0 0 0 .7.29a1 1 0 0 0 .71-.29a1 1 0 0 0 0-1.41l-.71-.71a1 1 0 0 0-1.41 1.41zm12 .29a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.64.71a1 1 0 0 0 0 1.41a1 1 0 0 0 .66.29zM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2zm-9 8a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1zm6.36-2A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0a1 1 0 0 0 0-1.41zM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5zm0 9a3.5 3.5 0 1 1 3.5-3.5a3.5 3.5 0 0 1-3.5 3.5z" fill="currentColor"></path></svg></button></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-34e9bec6><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#一、挖矿的网络架构">一、挖矿的网络架构</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#二、stratum-协议">二、stratum 协议</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#_1-任务订阅">1. 任务订阅</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_2-矿机登录">2. 矿机登录</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_3-难度调整">3. 难度调整</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_4-任务分配">4. 任务分配</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_5-结果提交">5. 结果提交</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#三、一般通讯过程">三、一般通讯过程</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-3343bde8><div class="container" data-v-3343bde8><!--[--><!--]--><div style="position:relative;" class="content" data-v-3343bde8><div><h1 id="以太坊-stratum-协议原理" tabindex="-1">以太坊 stratum 协议原理 <a class="header-anchor" href="#以太坊-stratum-协议原理" aria-hidden="true" target="_blank" rel="noopener">#</a></h1><p>参照比特币的<a href="http://www.8btc.com/stratum_protocol" target="_blank" rel="noopener noreferrer">stratum 协议</a> 和<a href="http://www.jianshu.com/p/7bfe925f3d0a" target="_blank" rel="noopener noreferrer">NiceHash 的 stratum 协议规范</a>编写了一版以太坊版本的 stratum 协议说明.</p><hr><p>stratum 协议是目前最常用的矿机和矿池之间的 TCP 通讯协议。</p><h2 id="一、挖矿的网络架构" tabindex="-1">一、挖矿的网络架构 <a class="header-anchor" href="#一、挖矿的网络架构" aria-hidden="true" target="_blank" rel="noopener">#</a></h2><p>以太坊是一个去中心化的网络架构，通过安装 Mist 客户端的节点来转发新交易和新区块。而矿机、矿池也同时形成了另一个网络，我们称之为矿工网络。</p><p>矿工网络分成矿机、矿池、钱包等几个主要部分，有时矿池软件与钱包安装在一起，可合称为矿池。</p><p>矿机与矿池软件之间的通讯协议是<code>stratum</code>，而矿池软件与钱包之间的通讯是<code>bitcoinrpc</code>接口。</p><p>stratum 是<code>JSON</code>为数据格式.</p><h2 id="二、stratum-协议" tabindex="-1">二、stratum 协议 <a class="header-anchor" href="#二、stratum-协议" aria-hidden="true" target="_blank" rel="noopener">#</a></h2><h3 id="_1-任务订阅" tabindex="-1">1. 任务订阅 <a class="header-anchor" href="#_1-任务订阅" aria-hidden="true" target="_blank" rel="noopener">#</a></h3><p>矿机启动，首先以<code>mining.subscribe</code>方法向矿池连接，用来订阅工作。</p><p>矿池以<code>mining.notify</code>返回订阅号、ExtraNonce1 和 ExtraNonce2_size。</p><p>Client:</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mining.subscribe&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;MinerName/1.0.0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EthereumStratum/1.0.0&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Server:</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;mining.notify&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ae6812eb4cd7735a302a8a9dd95cf71f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EthereumStratum/1.0.0&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;080c&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>其中：</p><p>ae6812eb4cd7735a302a8a9dd95cf71f 是<code>订阅号</code>；</p><p>080c 是<code>extranonce</code>，Extranonce 可能最大 3 字节；</p><h3 id="_2-矿机登录" tabindex="-1">2. 矿机登录 <a class="header-anchor" href="#_2-矿机登录" aria-hidden="true" target="_blank" rel="noopener">#</a></h3><p>矿机以<code>mining.authorize</code>方法，用某个帐号和密码登录到矿池，密码可空，矿池返回<code>true</code>登录成功。该方法必须是在初始化连接之后马上进行，否则矿机得不到矿池任务。</p><p>Client:</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span> <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;miner1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mining.authorize&quot;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Server:</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span> <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span> <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-难度调整" tabindex="-1">3. 难度调整 <a class="header-anchor" href="#_3-难度调整" aria-hidden="true" target="_blank" rel="noopener">#</a></h3><p>难度调整由矿池下发给矿机，以<code>mining.set_difficulty</code>方法调整难度，<code>params</code>中是难度值。 Server:</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span> <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span> <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mining.set_difficulty&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>矿机会在下一个任务时采用新难度，矿池有时会马上下发一个新任务并且把清理任务设为 true，以便矿机马上以新难度工作。</p><h3 id="_4-任务分配" tabindex="-1">4. 任务分配 <a class="header-anchor" href="#_4-任务分配" aria-hidden="true" target="_blank" rel="noopener">#</a></h3><p>该命令由矿池定期发给矿机，当矿机以<code>mining.subscribe</code>方法登记后，矿池应该马上以<code>mining.notify</code>返回该任务。</p><p>Server:</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mining.notify&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;bf0488aa&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;abad8f99f3918bf903c6a909d9bbc0fdfa5a2f4b9cb1196175ec825c6610126c&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;645cf20198c2f3861e947d4f67e3ab63b7b2e24dcc9095bd9123e7b33371f6cc&quot;</span><span class="token punctuation">,</span>
    <span class="token boolean">true</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>任务 ID</strong>：<code>bf0488aa</code>；</p><p><strong>seedhash</strong>：<code>abad8f99f3918bf903c6a909d9bbc0fdfa5a2f4b9cb1196175ec825c6610126c</code>。每一个任务都发送一个 seedhash 来支持尽可能多的矿池，这可能会很快地在货币之间交换。</p><p><strong>headerhash</strong>: <code>645cf20198c2f3861e947d4f67e3ab63b7b2e24dcc9095bd9123e7b33371f6cc</code>。</p><p>boolean <strong>cleanjobs</strong>: <code>true</code>。如果设为 true，那么矿工需要清理任务队列，并立即开始从事新提供的任务，因为所有旧的任务分享都将导致陈旧的分享错误。如果是<code>false</code>则等当前任务结束才开始新任务。</p><h3 id="_5-结果提交" tabindex="-1">5. 结果提交 <a class="header-anchor" href="#_5-结果提交" aria-hidden="true" target="_blank" rel="noopener">#</a></h3><p>矿工使用 seedhash 识别 DAG，然后带着 headerhash,extranonce 和自己的 minernonce 寻找低于目标的 share(这是由提供的难度而产生的)。</p><p>矿机找到合法 share 时，就以”<code>mining.submit</code>“方法向矿池提交任务。矿池返回 true 即提交成功，如果失败则 error 中有具体原因。</p><p>Client:</p><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">244</span><span class="token punctuation">,</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mining.submit&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bf0488aa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;6a909d9bbc0f&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>任务 ID</strong>: <code>bf0488aa</code></p><p><strong>minernonce</strong>: <code>6a909d9bbc0f</code>。注意 minernonce 是 6 个字节，因为提供的 extranonce 是 2 个字节。如果矿池提供 3 字节的 extranonce，那么 minernonce 必须是 5 字节</p><p>Server:</p><ul><li>接受结果:</li></ul><div class="language-json line-numbers-mode"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">244</span><span class="token punctuation">,</span>
  <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>不被接受:</li></ul><div class="language-json line-numbers-mode"><pre><code>  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">244</span><span class="token punctuation">,</span>
    <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>

      <span class="token number">-1</span><span class="token punctuation">,</span>
      <span class="token string">&quot;Job not found&quot;</span><span class="token punctuation">,</span>
      NULL
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="三、一般通讯过程" tabindex="-1">三、一般通讯过程 <a class="header-anchor" href="#三、一般通讯过程" aria-hidden="true" target="_blank" rel="noopener">#</a></h2><p>一般的矿机与矿池通讯过程就如下所示：</p><div class="language-mermaid line-numbers-mode"><pre><code><span class="token keyword">sequenceDiagram</span>
矿机<span class="token arrow operator">-&gt;&gt;</span> 矿池<span class="token operator">:</span> mining.subscribe
<span class="token keyword">Note left of</span> 矿机<span class="token operator">:</span> 矿机任务订阅
矿池<span class="token arrow operator">-&gt;&gt;</span> 矿机<span class="token operator">:</span> mining.notify
<span class="token keyword">Note right of</span> 矿池<span class="token operator">:</span> 回复当前EthereumStratum/Version和extranonce
矿机<span class="token arrow operator">-&gt;&gt;</span> 矿池<span class="token operator">:</span> mining.authorize
<span class="token keyword">Note left of</span> 矿机<span class="token operator">:</span> 矿机认证
矿池<span class="token arrow operator">-&gt;&gt;</span> 矿机<span class="token operator">:</span> 返回认证结果
矿池<span class="token arrow operator">-&gt;&gt;</span> 矿机<span class="token operator">:</span> mining.set_difficulty
<span class="token keyword">Note right of</span> 矿池<span class="token operator">:</span> 矿池更新难度
矿池<span class="token arrow operator">-&gt;&gt;</span> 矿机<span class="token operator">:</span> mining.set_extranonce
<span class="token keyword">Note right of</span> 矿池<span class="token operator">:</span> 矿池更新extranonce
矿池<span class="token arrow operator">-&gt;&gt;</span> 矿机<span class="token operator">:</span> mining.notify
<span class="token keyword">Note right of</span> 矿池<span class="token operator">:</span> 通知矿工工作
矿机<span class="token arrow operator">-&gt;&gt;</span> 矿池<span class="token operator">:</span> mining.submit
<span class="token keyword">Note left of</span> 矿机<span class="token operator">:</span> 矿机提交任务对应的minernonce
矿池<span class="token arrow operator">-&gt;&gt;</span> 矿机<span class="token operator">:</span> 是否接收share
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><img src="/imgs/blogs/2237-d27579071cabc8c0.jpg" alt="矿机与矿池通讯过程"></p></div></div><footer class="page-footer" data-v-3343bde8 data-v-4b1dabee><div class="edit" data-v-4b1dabee><div class="edit-link" data-v-4b1dabee data-v-8bf3d9b4><!----></div></div><div class="updated" data-v-4b1dabee><!----></div></footer><!----><!--[--><!--]--></div></main></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"3bf6d415\",\"blogs_ammandliquiditypool.md\":\"57bcf4c6\",\"blogs_btcminning.md\":\"4f90b0e4\",\"blogs_ethstratum.md\":\"b9e35113\",\"blogs_fixedrateincomeagreement.md\":\"6056da72\",\"blogs_floatcapital.md\":\"31850f08\",\"blogs_olympusdao.md\":\"72b206bd\",\"defi_nftdefi.md\":\"36ed5d57\",\"defi_ohmcalc.md\":\"8a71bdda\",\"defi_timecalc.md\":\"1ab7bffb\",\"index.md\":\"27734208\",\"other_contact.md\":\"2802b674\",\"other_qa.md\":\"004391c5\",\"other_story.md\":\"04c4518b\",\"other_teams.md\":\"bdde64dd\",\"pool_epik-f019807.md\":\"d1cb28a3\",\"pool_epik-f052187.md\":\"45cc821c\",\"pool_epik-f082279.md\":\"eb484f7c\",\"pool_epik-f089847.md\":\"75b7ac31\",\"products_compare.md\":\"5d802e27\",\"products_filecoin.md\":\"d764f46d\",\"products_product1.md\":\"6671a242\",\"products_product2.md\":\"b9a54510\",\"products_product3.md\":\"b3b08dfc\",\"service_intro.md\":\"eed22681\",\"service_solution1.md\":\"e12fc1ea\",\"service_solution2.md\":\"b1e711cf\"}")</script>
    <script type="module" async src="/assets/app.99e6884a.js"></script>
    
  </body>
</html>